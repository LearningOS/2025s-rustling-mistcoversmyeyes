### ğŸ¤– Assistant

# Rust vs C++ HashMap æ–¹æ³•é€ŸæŸ¥æ‰‹å†Œ

ç»“åˆä½ å®Œæˆçš„ Rustlings ä¹ é¢˜ï¼Œä»¥ä¸‹æ˜¯å…³é”®æ–¹æ³•çš„åˆ†ç±»å¯¹æ¯”ï¼š

## ä¸€ã€åŸºç¡€æ“ä½œç±»

| æ“ä½œ         | C++ (std::unordered_map)       | Rust (std::collections::HashMap) | å¯¹åº”ä¹ é¢˜ |
|--------------|---------------------------------|-----------------------------------|----------|
| **åˆ›å»ºç©ºmap** | `std::unordered_map<K, V> map;` | `HashMap::new()`                 | iter5    |
| **æ’å…¥å…ƒç´ **  | `insert({key, value})`          | `insert(key, value)`             | iter5    |
| **è·å–å…ƒç´ **  | `at(key)`                       | `get(&key)` â†’ `Option<&V>`       | iter5    |
| **åˆ é™¤å…ƒç´ **  | `erase(key)`                    | `remove(&key)` â†’ `Option<V>`     | -        |

## äºŒã€è¿­ä»£å™¨ç›¸å…³

| æ“ä½œ                | C++ é£æ ¼                          | Rust è¿­ä»£å™¨é“¾                          | å¯¹åº”ä¹ é¢˜ |
|---------------------|-----------------------------------|----------------------------------------|----------|
| **éå†æ‰€æœ‰é”®å€¼å¯¹**  | `for (const auto& [k, v] : map)`  | `for (k, v) in &map`                  | iter1    |
| **ä»…éå†å€¼**        | æ‰‹åŠ¨è·å–secondå€¼                  | `map.values()` â†’ `Iterator<Item=&V>`  | iter5    |
| **è¿‡æ»¤å…ƒç´ **        | æ‰‹åŠ¨ifåˆ¤æ–­                        | `.filter(|(k, v)| condition)`         | iter5    |
| **å…ƒç´ è½¬æ¢**        | åˆ›å»ºæ–°å®¹å™¨æ‰‹åŠ¨è½¬æ¢                | `.map(|(k, v)| transform)`            | iter2    |
| **åµŒå¥—ç»“æ„å¤„ç†**    | å¤šé‡åµŒå¥—å¾ªç¯                      | `.flat_map(|inner| inner.iter())`     | iter5    |

## ä¸‰ã€ç‰¹æ®Šæ–¹æ³•å¯¹æ¯”

### 1. å­˜åœ¨æ€§æ£€æŸ¥
```cpp
// C++
if (map.contains(key)) { ... }
```
```rust
// Rust (æ¥è‡ªä¹ é¢˜iter5)
if map.contains_key(&key) { ... }  // å›ºæœ‰æ–¹æ³•
```

### 2. æ¡ç›®å¤„ç† (Entry API)
```cpp
// C++ (éœ€æ‰‹åŠ¨æ£€æŸ¥)
auto it = map.find(key);
if (it == map.end()) {
    map.insert({key, default});
}
```
```rust
// Rust (æ¥è‡ªæ ‡å‡†åº“)
map.entry(key).or_insert(default);  // å›ºæœ‰æ–¹æ³•
```

### 3. å®¹é‡ç®¡ç†
| æ“ä½œ              | C++                  | Rust                    |
|-------------------|----------------------|-------------------------|
| é¢„åˆ†é…ç©ºé—´        | `reserve(n)`         | `reserve(n)` (å›ºæœ‰æ–¹æ³•) |
| ç¼©å‡å®¹é‡          | `shrink_to_fit()`    | `shrink_to_fit()`       |

## å››ã€ä¹ é¢˜æ–¹æ³•æ˜ å°„è¡¨

### iterators2
```rust
// å­—ç¬¦ä¸²å¤„ç†
vec!["a", "b"].iter().map(|s| capitalize_first(s)).collect()
```
å¯¹åº” C++ å®ç°ï¼š
```cpp
std::vector<std::string> result;
for (const auto& s : vec) {
    result.push_back(capitalize_first(s));
}
```

### iterators3
```rust
// é”™è¯¯å¤„ç†æ¨¡å¼
numbers.into_iter().map(|n| divide(n, 27)).collect::<Result<Vec<_>, _>>()
```
C++ æ— ç›´æ¥å¯¹åº”ï¼Œéœ€æ‰‹åŠ¨åˆ›å»ºç»“æœå®¹å™¨ï¼š
```cpp
std::vector<Result<int>> results;
for (auto n : numbers) {
    results.push_back(divide(n, 27));
}
```

### iterators4
```rust
// é˜¶ä¹˜å®ç°
(1..=num).product()  // ä½¿ç”¨Iteratorçš„productæ–¹æ³•
```
å¯¹åº” C++ å®ç°ï¼š
```cpp
int product = 1;
for (int i = 1; i <= num; ++i) {
    product *= i;
}
```

## äº”ã€æ€§èƒ½ä¸å®‰å…¨æ³¨æ„äº‹é¡¹

1. **è¿­ä»£å™¨å¤±æ•ˆé—®é¢˜**ï¼š
   - C++ï¼šä¿®æ”¹å®¹å™¨ä¼šä½¿å…¶è¿­ä»£å™¨å¤±æ•ˆ
   - Rustï¼šç¼–è¯‘å™¨é€šè¿‡å€Ÿç”¨æ£€æŸ¥é˜»æ­¢å±é™©æ“ä½œ

2. **å†…å­˜é¢„åˆ†é…**ï¼š
   ```rust
   let mut map = HashMap::with_capacity(100); // ç±»ä¼¼C++çš„reserve
   ```

3. **æŸ¥æ‰¾æ€§èƒ½**ï¼š
   | æ“ä½œ          | C++ å¤æ‚åº¦       | Rust å¤æ‚åº¦       |
   |---------------|-----------------|-------------------|
   | æ’å…¥/æŸ¥æ‰¾     | å¹³å‡O(1)        | å¹³å‡O(1)          |
   | éå†          | O(n)            | O(n)              |

## å…­ã€Rust ç‰¹æœ‰æ–¹æ³•é€ŸæŸ¥

### æ¥è‡ªä¹ é¢˜çš„å…³é”®æ–¹æ³•
```rust
// iterators5 æ ¸å¿ƒæ–¹æ³•
collection.iter()
    .flat_map(|map| map.values())  // å±•å¹³åµŒå¥—ç»“æ„
    .filter(|&p| *p == target)     // è¿‡æ»¤ç›®æ ‡å€¼
    .count()                       // è®¡æ•°
```

### å®ç”¨æ–¹æ³•æ‰©å±•
| æ–¹æ³•                 | ä½œç”¨                           | C++è¿‘ä¼¼å®ç°             |
|----------------------|--------------------------------|-------------------------|
| `entry(key)`         | å®‰å…¨åœ°å¤„ç†å­˜åœ¨/ä¸å­˜åœ¨çš„é”®       | `find` + `insert`       |
| `retain(|k, v| cond)`| å°±åœ°è¿‡æ»¤å…ƒç´                    | æ‰‹åŠ¨åˆ›å»ºæ–°å®¹å™¨           |
| `drain()`            | æ¶ˆè´¹è¿­ä»£å¹¶æ¸…ç©ºå®¹å™¨             | `std::move_iterator`    |

å»ºè®®æ‰“å°æ­¤è¡¨æ”¾åœ¨æ‰‹è¾¹ï¼Œé‡åˆ°æ–¹æ³•é€‰æ‹©å›°éš¾æ—¶å¯å¿«é€Ÿå¯¹ç…§ã€‚éœ€è¦æˆ‘è§£é‡ŠæŸä¸ªæ–¹æ³•çš„åº•å±‚å®ç°ç»†èŠ‚å—ï¼Ÿ